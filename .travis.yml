language: java
sudo: true
services:
  - docker
jdk: openjdk8
env:
  global:
    - SHA=$(git rev-parse HEAD)

before_install:
  - chmod +x mvnw

script:
  - mvn clean install -DskipTests
  - docker-compose up
  - mvn test

after_script:
  - docker-compose down

before_deploy:
  - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin

deploy:
  provider: script
  script: bash ./docker_push.sh
